<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Brother - Divine Space Blessing</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&family=Noto+Sans+Devanagari:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        :root {
            --primary-blue:#1E90FF; --secondary-blue:#4169E1;
            --accent-gold:#FFD700; --sky-blue:#87CEEB;
            --divine-gold:#FFA500; --text-white:#FFFFFF;
            --font-primary:'Orbitron',sans-serif;
            --font-secondary:'Rajdhani',sans-serif;
            --font-sanskrit:'Noto Sans Devanagari',sans-serif;
        }
        body {
            font-family:var(--font-secondary);
            background:#000; overflow:hidden;
            width:100vw; height:100vh; color:#fff;
        }

        /* â”€â”€ PERF FIX 1: Remove all animated CSS nebulas â€” replaced with static CSS only â”€â”€ */
        #space3d { position:fixed;inset:0;z-index:1;pointer-events:none; }

        /* Static galaxy bg â€” NO animation, NO blur, GPU-composited via transform */
        .galaxy-background {
            position:fixed;inset:0;z-index:0;
            background:
                radial-gradient(ellipse at 20% 30%,rgba(138,43,226,0.35) 0%,transparent 50%),
                radial-gradient(ellipse at 80% 70%,rgba(30,144,255,0.35) 0%,transparent 50%),
                radial-gradient(ellipse at 40% 80%,rgba(255,20,147,0.2) 0%,transparent 50%),
                linear-gradient(180deg,#000428 0%,#001a4e 50%,#000428 100%);
            /* Single slow rotation â€” one layer, no scale jank */
            will-change:transform;
            animation:galaxyRotate 120s linear infinite;
        }
        @keyframes galaxyRotate {
            0%   { transform:rotate(0deg)   scale(1.15); }
            100% { transform:rotate(360deg) scale(1.15); }
        }
        /* REMOVED: .galaxy-layer-1/2 (two extra animated divs) */
        /* REMOVED: .nebula-1 through .nebula-5 (blur:120px is extremely expensive) */

        #starsCanvas { position:fixed;inset:0;z-index:2;pointer-events:none; }

        /* START SCREEN */
        .start-screen {
            position:fixed;inset:0;
            background:radial-gradient(ellipse at center,#001a33,#000);
            display:flex;flex-direction:column;justify-content:center;align-items:center;
            z-index:1000;
        }
        .mission-title {
            font-family:var(--font-primary);
            font-size:clamp(1.5rem,4vw,2.5rem);
            color:var(--accent-gold);margin-bottom:20px;text-align:center;
            letter-spacing:6px;text-shadow:0 0 30px rgba(255,215,0,0.8);
            animation:titleGlow 3s ease-in-out infinite;
        }
        @keyframes titleGlow {
            0%,100%{text-shadow:0 0 30px rgba(255,215,0,0.8);}
            50%{text-shadow:0 0 50px rgba(255,215,0,1),0 0 80px rgba(255,215,0,0.5);}
        }
        .start-button {
            padding:28px 70px;font-size:1.8rem;font-weight:900;
            font-family:var(--font-primary);color:#fff;
            background:linear-gradient(135deg,#1E90FF,#4169E1);
            border:3px solid #FFD700;border-radius:60px;cursor:pointer;
            box-shadow:0 10px 40px rgba(30,144,255,0.6),0 0 30px rgba(255,215,0,0.4);
            letter-spacing:4px;text-transform:uppercase;
            transition:transform .3s,box-shadow .3s;
        }
        .start-button:hover {
            transform:scale(1.08);
            box-shadow:0 15px 60px rgba(30,144,255,0.8),0 0 50px rgba(255,215,0,0.6);
        }

        /* CINEMATIC */
        .cinematic-container {
            position:fixed;inset:0;z-index:10;overflow:hidden;opacity:0;
            perspective:2000px;transform-style:preserve-3d;
        }
        .cinematic-container::after {
            content:'';position:absolute;inset:0;
            background:radial-gradient(ellipse at center,transparent 30%,rgba(0,0,0,0.7) 100%);
            pointer-events:none;z-index:100;
        }
        .photo-slide {
            position:absolute;top:50%;left:50%;width:80%;height:80%;
            opacity:0;transform-style:preserve-3d;
            transform:translate(-50%,-50%);will-change:transform,opacity;
        }
        /* PERF FIX 2: Removed blur glow pseudo-element on .photo-slide::before */
        .photo-slide img {
            width:100%;height:100%;object-fit:cover;border-radius:25px;
            filter:brightness(0.95) contrast(1.1) saturate(1.1);
            box-shadow:0 40px 100px rgba(0,0,0,0.9),0 0 40px rgba(30,144,255,0.3);
            will-change:transform;backface-visibility:hidden;
        }

        .flash-overlay {
            position:fixed;inset:0;
            background:radial-gradient(ellipse at center,rgba(255,255,255,0.95) 0%,transparent 70%);
            opacity:0;pointer-events:none;z-index:100;mix-blend-mode:screen;will-change:opacity;
        }

        /* FINAL MESSAGE */
        .final-message {
            position:fixed;inset:0;
            display:flex;justify-content:center;align-items:center;flex-direction:column;
            background:radial-gradient(ellipse at center,rgba(0,4,40,0.85),rgba(0,0,0,0.96));
            z-index:500;opacity:0;pointer-events:none;
        }
        .final-message.visible{opacity:1;pointer-events:auto;}
        .birthday-text {
            font-family:var(--font-primary);
            font-size:clamp(2.5rem,8vw,7rem);font-weight:900;
            background:linear-gradient(135deg,#87CEEB,#1E90FF,#FFD700,#FFA500,#1E90FF);
            background-size:400% 400%;
            background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent;
            text-align:center;padding:0 30px;
            letter-spacing:6px;line-height:1.3;
            animation:gradShift 6s ease infinite;min-height:1.2em;
        }
        .birthday-text .typed-text{display:inline-block;}
        .birthday-text .cursor{
            display:inline-block;width:4px;height:1em;background:#FFD700;
            margin-left:6px;animation:blink 1s infinite;vertical-align:baseline;
        }
        @keyframes gradShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
        @keyframes blink{0%,50%{opacity:1}51%,100%{opacity:0}}

        .shloka-container{margin-top:40px;text-align:center;max-width:90%;opacity:0;}
        .shloka-text{font-family:var(--font-sanskrit);font-size:clamp(1.5rem,4vw,2.5rem);color:#FFD700;line-height:1.8;text-shadow:0 0 20px rgba(255,215,0,0.6);letter-spacing:2px;}
        .shloka-translation{font-family:var(--font-secondary);font-size:clamp(1rem,2.5vw,1.5rem);color:#87CEEB;line-height:1.6;font-style:italic;margin-top:10px;}

        #shivaContainer {
            position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
            z-index:400;pointer-events:none;opacity:0;
            width:min(90vw,800px);height:min(90vh,1000px);
            display:flex;justify-content:center;align-items:center;
        }
        .shiva-image-wrapper{position:relative;width:100%;height:100%;display:flex;justify-content:center;align-items:center;}
        /* PERF FIX 3: Shiva glow reduced from 3 drop-shadows to 1, animation slowed to 5s */
        .shiva-image {
            width:100%;height:100%;object-fit:contain;
            filter:drop-shadow(0 0 60px rgba(255,215,0,0.9));
            animation:shivaGlow 5s ease-in-out infinite;
            transform-origin:center;will-change:filter,transform;
        }
        @keyframes shivaGlow {
            0%,100%{filter:drop-shadow(0 0 60px rgba(255,215,0,0.9));transform:scale(1);}
            50%{filter:drop-shadow(0 0 90px rgba(255,215,0,1));transform:scale(1.02);}
        }
        .shiva-aura {
            position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
            width:120%;height:120%;
            background:radial-gradient(circle,rgba(255,215,0,0.15) 0%,rgba(30,144,255,0.08) 60%,transparent 80%);
            border-radius:50%;animation:auraPulse 6s ease-in-out infinite;
        }
        @keyframes auraPulse {
            0%,100%{transform:translate(-50%,-50%) scale(1);opacity:0.5;}
            50%{transform:translate(-50%,-50%) scale(1.1);opacity:0.7;}
        }

        .motivational-quote{position:fixed;top:20%;left:50%;transform:translateX(-50%);z-index:450;text-align:center;opacity:0;pointer-events:none;max-width:90%;padding:0 20px;}
        .quote-text{font-family:var(--font-primary);font-size:clamp(1.2rem,3vw,2rem);color:#FFD700;line-height:1.6;letter-spacing:2px;margin-bottom:15px;font-weight:700;text-shadow:0 0 20px rgba(255,215,0,0.7);}
        .quote-author{font-family:var(--font-secondary);font-size:clamp(1rem,2vw,1.4rem);color:#87CEEB;font-style:italic;}

        .shiva-blessing{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:450;text-align:center;opacity:0;pointer-events:none;}
        .shiva-message{font-family:var(--font-primary);font-size:clamp(2rem,5vw,4rem);color:#FFA500;margin-bottom:20px;letter-spacing:4px;text-shadow:0 0 30px rgba(255,165,0,0.8);}
        .shiva-subtitle{font-family:var(--font-secondary);font-size:clamp(1.2rem,3vw,2rem);color:#87CEEB;letter-spacing:3px;}

        .birthday-message{margin-top:30px;font-family:var(--font-secondary);font-size:clamp(1rem,2.5vw,1.5rem);color:#fff;line-height:1.8;max-width:800px;padding:0 20px;opacity:0;}

        /* PERF FIX 4: glow-effect reduced from 800px to 500px, opacity lowered */
        .glow-effect{
            position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
            width:500px;height:500px;
            background:radial-gradient(circle,rgba(30,144,255,0.35),transparent 70%);
            opacity:0.4;animation:pulseGlow 5s ease-in-out infinite;z-index:1;
        }
        @keyframes pulseGlow{0%,100%{transform:translate(-50%,-50%) scale(1);opacity:0.4;}50%{transform:translate(-50%,-50%) scale(1.25);opacity:0.6;}}

        .confetti-canvas{position:fixed;inset:0;pointer-events:none;z-index:999;opacity:0;}
        .confetti-canvas.visible{opacity:1;}

        @media(max-width:768px){
            .start-button{padding:24px 50px;font-size:1.4rem;}
            .birthday-text{font-size:clamp(2rem,10vw,4rem);padding:0 20px;}
            .shloka-text{font-size:clamp(1.2rem,5vw,1.8rem);}
        }

        /* POST-BIRTHDAY SEQUENCE */
        #postBlackout{position:fixed;inset:0;background:#000;z-index:2000;opacity:0;pointer-events:none;}
        #postGalaxyCanvas{position:fixed;inset:0;z-index:2001;opacity:0;pointer-events:none;}
        #photoGallery{position:fixed;inset:0;z-index:2010;opacity:0;pointer-events:none;display:flex;justify-content:center;align-items:center;}
        .gallery-photo{
            position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
            opacity:0;border-radius:20px;overflow:hidden;background:#000;
            box-shadow:0 0 50px rgba(30,144,255,0.5),0 30px 70px rgba(0,0,0,0.9);
        }
        .gallery-photo img{width:100%;height:100%;object-fit:contain;display:block;background:#000;}
        .gallery-photo::before,.gallery-photo::after{
            content:'';position:absolute;width:36px;height:36px;
            border-color:rgba(255,215,0,0.8);border-style:solid;z-index:1;
        }
        .gallery-photo::before{top:10px;left:10px;border-width:3px 0 0 3px;border-radius:4px 0 0 0;}
        .gallery-photo::after{bottom:10px;right:10px;border-width:0 3px 3px 0;border-radius:0 0 4px 0;}

        #photoCounter{position:fixed;bottom:40px;left:50%;transform:translateX(-50%);z-index:2020;opacity:0;font-family:var(--font-primary);font-size:clamp(0.8rem,2vw,1rem);color:rgba(135,206,235,0.8);letter-spacing:4px;text-shadow:0 0 15px rgba(30,144,255,0.8);}
        #photoCaption{position:fixed;bottom:75px;left:50%;transform:translateX(-50%);z-index:2020;opacity:0;font-family:var(--font-primary);font-size:clamp(1rem,3vw,1.8rem);color:#FFD700;letter-spacing:3px;text-shadow:0 0 20px rgba(255,215,0,0.8);text-align:center;max-width:90%;white-space:nowrap;}
        #photoDots{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);z-index:2020;display:flex;gap:10px;opacity:0;}
        .photo-dot{width:8px;height:8px;border-radius:50%;background:rgba(135,206,235,0.3);border:1px solid rgba(135,206,235,0.6);transition:background .4s,box-shadow .4s,transform .4s;}
        .photo-dot.active{background:#FFD700;border-color:#FFD700;box-shadow:0 0 10px #FFD700;transform:scale(1.4);}

        #endCard{
            position:fixed;inset:0;z-index:2030;opacity:0;pointer-events:none;
            display:flex;flex-direction:column;justify-content:center;align-items:center;
            background:radial-gradient(ellipse at center,rgba(0,4,40,0.9),rgba(0,0,0,0.98));
        }
        .end-title{
            font-family:var(--font-primary);font-size:clamp(2rem,6vw,5rem);font-weight:900;
            background:linear-gradient(135deg,#87CEEB,#FFD700,#FFA500,#1E90FF);
            background-size:400% 400%;
            background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent;
            animation:gradShift 4s ease infinite;letter-spacing:4px;text-align:center;padding:0 20px;margin-bottom:20px;
        }
        .end-subtitle{font-family:var(--font-sanskrit);font-size:clamp(1.5rem,4vw,2.5rem);color:#FFD700;text-shadow:0 0 30px rgba(255,215,0,0.8);letter-spacing:3px;text-align:center;margin-bottom:15px;}
        .end-translation{font-family:var(--font-secondary);font-size:clamp(0.9rem,2.5vw,1.3rem);color:#87CEEB;font-style:italic;letter-spacing:2px;text-align:center;}
    </style>
</head>
<body>
    <div id="space3d"></div>
    <div class="galaxy-background"></div>
    <!-- REMOVED: galaxy-layer-1, galaxy-layer-2, nebula-1 through nebula-5 -->
    <canvas id="starsCanvas"></canvas>

    <div id="startScreen" class="start-screen">
        <div class="mission-title">ğŸš€ DIVINE SPACE JOURNEY ğŸš€</div>
        <button id="startButton" class="start-button">ğŸ•‰ï¸ BEGIN BLESSING ğŸ•‰ï¸</button>
    </div>

    <div id="cinematicContainer" class="cinematic-container"></div>

    <div id="shivaContainer">
        <div class="shiva-aura"></div>
        <div class="shiva-image-wrapper">
            <img src="" alt="Lord Shiva Nataraja" class="shiva-image" id="shivaImage">
        </div>
    </div>

    <div class="motivational-quote" id="motivationalQuote">
        <div class="quote-text" id="quoteText"></div>
        <div class="quote-author" id="quoteAuthor"></div>
    </div>

    <div class="shiva-blessing" id="shivaBlessing">
        <div class="shiva-message">ğŸ•‰ï¸ Lord Shiva's Blessings ğŸ•‰ï¸</div>
        <div class="shiva-subtitle">May Divine Grace Be Upon You</div>
    </div>

    <div id="finalMessage" class="final-message">
        <h1 class="birthday-text">
            <span class="typed-text"></span>
            <span class="cursor"></span>
        </h1>
        <div class="shloka-container" id="shlokaContainer">
            <div class="shloka-text" id="shloka1"></div>
            <div class="shloka-translation" id="shloka1Trans"></div>
            <div class="shloka-text" id="shloka2" style="margin-top:30px;"></div>
            <div class="shloka-translation" id="shloka2Trans"></div>
        </div>
        <div class="birthday-message" id="birthdayMessage"></div>
        <div class="glow-effect"></div>
    </div>

    <canvas id="confettiCanvas" class="confetti-canvas"></canvas>
    <div id="flashOverlay" class="flash-overlay"></div>

    <audio id="backgroundMusic" preload="auto" loop playsinline>
        <source src="music1.mp3" type="audio/mpeg">
    </audio>
    <audio id="introVoice" preload="auto">
        <source src="voice.mp3" type="audio/mpeg">
    </audio>

    <!-- POST-BIRTHDAY SEQUENCE -->
    <div id="postBlackout"></div>
    <canvas id="postGalaxyCanvas"></canvas>
    <div id="photoGallery"></div>
    <div id="photoCaption"></div>
    <div id="photoCounter"></div>
    <div id="photoDots"></div>
    <div id="endCard">
        <div class="end-title">âœ¨ Always &amp; Forever âœ¨</div>
        <div class="end-subtitle">à¥ à¤¨à¤®à¤ƒ à¤¶à¤¿à¤µà¤¾à¤¯</div>
        <div class="end-translation">May Lord Shiva always walk beside you, dear brother ğŸ•‰ï¸</div>
    </div>
    <audio id="postMusic" preload="auto" loop playsinline>
        <source src="music2.mp3" type="audio/mpeg">
    </audio>

<script>
'use strict';
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PERFORMANCE BUDGET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const isMobile    = window.innerWidth < 768;
const STAR_COUNT  = isMobile ? 300  : 500;   // was 800
const PLANET_SEG  = isMobile ? 24   : 32;    // was 64
const THREE_STARS = isMobile ? 2000 : 3500;  // was 8000
const CONFETTI_N  = isMobile ? 100  : 180;   // was 400
const POST_STARS  = isMobile ? 400  : 700;   // was 1200
const PIX_RATIO   = Math.min(window.devicePixelRatio, 1.5); // cap DPR

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG (original, untouched)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CONFIG = {
    photoTimings: [
        { duration:3.5, zoom:1.2,  moveX:30,  moveY:0,   rotate:2,   rotateY:15,  translateZ:200, flash:true,  beatPunch:true  },
        { duration:3.2, zoom:1.15, moveX:-20, moveY:15,  rotate:-1,  rotateY:-10, translateZ:150, flash:false, beatPunch:false },
        { duration:3.8, zoom:1.25, moveX:15,  moveY:-20, rotate:1.5, rotateY:20,  translateZ:250, flash:true,  beatPunch:true  },
        { duration:3.0, zoom:1.18, moveX:-25, moveY:10,  rotate:-2,  rotateY:-15, translateZ:180, flash:false, beatPunch:false },
        { duration:3.5, zoom:1.22, moveX:20,  moveY:-15, rotate:1,   rotateY:12,  translateZ:220, flash:true,  beatPunch:true  },
        { duration:3.3, zoom:1.17, moveX:-15, moveY:20,  rotate:-1.5,rotateY:-18, translateZ:190, flash:false, beatPunch:false },
    ],
    fadeInDuration: 0.8, fadeOutDuration: 0.6, flashDuration: 0.2,
    beatPunchScale: 1.05, beatPunchDuration: 0.15, containerFadeInDuration: 1.5,
};

const SHLOKAS = [
    { text:'à¥ à¤¨à¤®à¤ƒ à¤¶à¤¿à¤µà¤¾à¤¯', translation:'Om Namah Shivaya - Salutations to Lord Shiva' },
    { text:'à¤¸à¤°à¥à¤µà¥‡ à¤­à¤µà¤¨à¥à¤¤à¥ à¤¸à¥à¤–à¤¿à¤¨à¤ƒ à¤¸à¤°à¥à¤µà¥‡ à¤¸à¤¨à¥à¤¤à¥ à¤¨à¤¿à¤°à¤¾à¤®à¤¯à¤¾à¤ƒ', translation:'May all be happy, may all be free from illness' },
    { text:'à¤†à¤¯à¥à¤·à¥à¤®à¤¾à¤¨à¥ à¤­à¤µ à¤¸à¥Œà¤­à¤¾à¤—à¥à¤¯à¤‚ à¤¤à¥‡ à¤­à¤µà¤¤à¥ à¤¸à¤¦à¤¾', translation:'May you be long-lived and always fortunate' }
];

const BIRTHDAY_MESSAGES = [
    'On this special day, may Lord Shiva\'s divine blessings shower upon you.',
    'May you be blessed with wisdom, prosperity, and eternal happiness.',
    'As you journey through life, may the divine light guide your path.',
    'May every moment of your life be filled with joy and success.',
    'à¥ à¤¶à¤¾à¤¨à¥à¤¤à¤¿ à¤¶à¤¾à¤¨à¥à¤¤à¤¿ à¤¶à¤¾à¤¨à¥à¤¤à¤¿ - Om Shanti Shanti Shanti (Peace, Peace, Peace)'
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  THREE.JS â€” optimised
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let scene, camera, renderer, planets=[], spaceParticles=[], animationFrameId;
let _3dPaused = false;

function init3DSpace() {
    const container = document.getElementById('space3d');
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 8000);
    camera.position.z = 2000;

    // PERF: antialias OFF, capped pixel ratio
    renderer = new THREE.WebGLRenderer({ alpha:true, antialias:false });
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(PIX_RATIO);
    container.appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0x555555, 1));
    const sun = new THREE.DirectionalLight(0xAADDFF, 1);
    sun.position.set(1000, 1000, 1000);
    scene.add(sun);

    // Star field
    const geo = new THREE.BufferGeometry();
    const verts = new Float32Array(THREE_STARS * 3);
    for (let i=0; i<THREE_STARS*3; i++) verts[i] = (Math.random()-0.5)*6000;
    geo.setAttribute('position', new THREE.Float32BufferAttribute(verts, 3));
    scene.add(new THREE.Points(geo, new THREE.PointsMaterial({color:0xFFFFFF,size:2,transparent:true,opacity:0.85})));

    // PERF: fewer planets, lower segments, no glow meshes
    createPlanet(0x4A90E2, 120, -800, -400, -1500);
    createPlanet(0xFAD5A5, 160,  1000,  300, -2000, true);
    createPlanet(0xCD5C5C,  90, -600,  600, -1800);
    createPlanet(0xD2691E, 150, -1200,  200, -2200);
    createPlanet(0x4169E1, 110,   600,  800, -2500);

    // Small particle cloud
    const pgeo = new THREE.BufferGeometry();
    const pv = new Float32Array(150*3);
    for (let i=0; i<450; i++) pv[i]=(Math.random()-0.5)*4000;
    pgeo.setAttribute('position', new THREE.Float32BufferAttribute(pv,3));
    const pc = new THREE.Points(pgeo, new THREE.PointsMaterial({color:0x87CEEB,size:3,transparent:true,opacity:0.5,blending:THREE.AdditiveBlending}));
    scene.add(pc);
    spaceParticles.push(pc);

    animate3DSpace();
}

function createPlanet(color, size, x, y, z, hasRing=false) {
    const mat = new THREE.MeshPhongMaterial({color, emissive:color, emissiveIntensity:0.2, shininess:25});
    const planet = new THREE.Mesh(new THREE.SphereGeometry(size, PLANET_SEG, PLANET_SEG), mat);
    planet.position.set(x, y, z);
    planet.userData.rs = Math.random()*0.007+0.003;
    if (hasRing) {
        const ring = new THREE.Mesh(
            new THREE.RingGeometry(size*1.2, size*1.8, 48),
            new THREE.MeshBasicMaterial({color:0xDAA520, side:THREE.DoubleSide, transparent:true, opacity:0.6})
        );
        ring.rotation.x = Math.PI/2;
        planet.add(ring);
    }
    scene.add(planet);
    planets.push(planet);
}

function animate3DSpace() {
    animationFrameId = requestAnimationFrame(animate3DSpace);
    if (_3dPaused) return;
    planets.forEach(p => { p.rotation.y += p.userData.rs; });
    camera.position.z -= 2.5;
    if (camera.position.z < -5000) camera.position.z = 2000;
    spaceParticles.forEach(p => { p.rotation.y += 0.001; });
    renderer.render(scene, camera);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  2D STARS CANVAS â€” optimised
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const starsCanvas = document.getElementById('starsCanvas');
const starsCtx = starsCanvas.getContext('2d');
let stars=[], warpSpeed=1;

function initStars() {
    starsCanvas.width  = innerWidth;
    starsCanvas.height = innerHeight;
    stars = [];
    for (let i=0; i<STAR_COUNT; i++) {
        stars.push({
            x: (Math.random()-0.5)*innerWidth*2,
            y: (Math.random()-0.5)*innerHeight*2,
            z: Math.random()*4000,
            size: Math.random()*3+0.5,
            op: Math.random()*0.85+0.15,
            spd: Math.random()*2+0.8
        });
    }
}

function animateStars() {
    // PERF FIX 5: higher alpha = shorter trail = less overdraw per frame
    starsCtx.fillStyle = 'rgba(0,0,0,0.12)';
    starsCtx.fillRect(0, 0, starsCanvas.width, starsCanvas.height);
    const cx = starsCanvas.width/2, cy = starsCanvas.height/2;
    const P = 1000;

    stars.forEach(s => {
        s.z -= warpSpeed * s.spd;
        if (s.z <= 0) { s.z=4000; s.x=(Math.random()-0.5)*innerWidth*2; s.y=(Math.random()-0.5)*innerHeight*2; }
        const sc = P/(P+s.z);
        const x = cx+s.x*sc, y = cy+s.y*sc, sz = Math.max(0.4, s.size*sc*2);

        // PERF FIX 6: trail only when warping, and NO createLinearGradient per star
        if (warpSpeed > 2) {
            const sc2 = P/(P+s.z+warpSpeed*s.spd*5);
            starsCtx.strokeStyle = `rgba(135,206,235,${s.op*sc*0.45})`;
            starsCtx.lineWidth = sz;
            starsCtx.beginPath();
            starsCtx.moveTo(cx+s.x*sc2, cy+s.y*sc2);
            starsCtx.lineTo(x, y);
            starsCtx.stroke();
        }

        starsCtx.fillStyle = `rgba(255,255,255,${s.op*sc})`;
        starsCtx.beginPath();
        starsCtx.arc(x, y, sz/2, 0, Math.PI*2);
        starsCtx.fill();
    });

    requestAnimationFrame(animateStars);
}

function increaseWarpSpeed() {
    gsap.to({v:warpSpeed},{v:10,duration:0.4,ease:'power2.out',onUpdate:function(){warpSpeed=this.targets()[0].v;}});
    setTimeout(()=>gsap.to({v:warpSpeed},{v:1,duration:1,ease:'power2.in',onUpdate:function(){warpSpeed=this.targets()[0].v;}}),400);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SAMPLE PHOTOS â€” half resolution + JPEG compression
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SAMPLE_COLS = [['#1E90FF','#87CEEB'],['#4169E1','#ADD8E6'],['#00BFFF','#E0F6FF'],['#4682B4','#B0E0E6'],['#5F9EA0','#AFEEEE'],['#6495ED','#F0F8FF']];
const PHRASES     = ['âœˆï¸ DREAM BIG','ğŸ›« FLY HIGH','â˜ï¸ TOUCH THE SKY','ğŸŒŸ REACH FOR STARS','ğŸ›¬ WINGS OF HOPE','â­ PILOT IN MAKING'];
const samplePhotos = [];

function createSampleImage(i) {
    const c = document.createElement('canvas');
    c.width=960; c.height=540; // 960Ã—540 vs original 1920Ã—1080 â€” same look, 4Ã— fewer pixels
    const ctx=c.getContext('2d');
    const g=ctx.createLinearGradient(0,0,960,540);
    g.addColorStop(0,SAMPLE_COLS[i][0]); g.addColorStop(1,SAMPLE_COLS[i][1]);
    ctx.fillStyle=g; ctx.fillRect(0,0,960,540);
    ctx.fillStyle='rgba(255,255,255,0.18)';
    for(let j=0;j<25;j++){ctx.beginPath();ctx.arc(Math.random()*960,Math.random()*540,Math.random()*55+20,0,Math.PI*2);ctx.fill();}
    ctx.fillStyle='rgba(255,255,255,0.95)'; ctx.font='bold 64px Rajdhani,sans-serif';
    ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText(PHRASES[i],480,255);
    ctx.font='36px Rajdhani,sans-serif'; ctx.fillStyle='rgba(255,215,0,0.9)';
    ctx.fillText(`Flight Path ${i+1}`,480,320);
    return c.toDataURL('image/jpeg',0.82); // JPEG saves ~70% vs PNG
}
for(let i=0;i<6;i++) samplePhotos.push(createSampleImage(i));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DOM REFS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const startScreen        = document.getElementById('startScreen');
const startButton        = document.getElementById('startButton');
const cinematicContainer = document.getElementById('cinematicContainer');
const finalMessage       = document.getElementById('finalMessage');
const flashOverlay       = document.getElementById('flashOverlay');
const confettiCanvas     = document.getElementById('confettiCanvas');
const backgroundMusic    = document.getElementById('backgroundMusic');
const introVoice         = document.getElementById('introVoice');
const birthdayText       = document.querySelector('.birthday-text .typed-text');
const shlokaContainer    = document.getElementById('shlokaContainer');
const birthdayMessage    = document.getElementById('birthdayMessage');
let sequenceStarted = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PHOTO SLIDES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function createPhotoSlides() {
    samplePhotos.forEach((src, i) => {
        const slide = document.createElement('div');
        slide.className='photo-slide'; slide.id=`photo-${i}`;
        const img = document.createElement('img');
        img.src=src; img.alt=`Memory ${i+1}`;
        slide.appendChild(img); cinematicContainer.appendChild(slide);
    });
}

function fadeInMusic(audio, vol=0.7, dur=3) {
    audio.volume=0; audio.play().catch(()=>{});
    gsap.to(audio,{volume:vol,duration:dur,ease:'power2.out'});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  START BUTTON
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
startButton.addEventListener('click', () => {
    if (sequenceStarted) return;
    sequenceStarted = true;
    gsap.to(startButton,{scale:0.9,duration:0.1,onComplete:()=>gsap.to(startButton,{scale:1,duration:0.2})});
    init3DSpace(); initStars(); animateStars();
    introVoice?.play().catch(()=>{});
    if (backgroundMusic) { backgroundMusic.currentTime=0; fadeInMusic(backgroundMusic,0.7,4); }
    gsap.to(startScreen,{opacity:0,duration:1,ease:'power2.inOut',onComplete:()=>startScreen.style.display='none'});
    gsap.to(cinematicContainer,{opacity:1,duration:CONFIG.containerFadeInDuration,ease:'power2.inOut',delay:0.5,
        onComplete:()=>setTimeout(startCinematicSequence,300)});
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CINEMATIC SEQUENCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startCinematicSequence() { animatePhoto(0); }

function animatePhoto(index) {
    if (index >= samplePhotos.length) { showShiva(); setTimeout(showFinalMessage,5000); return; }
    const slide = document.getElementById(`photo-${index}`);
    const img   = slide.querySelector('img');
    const t     = CONFIG.photoTimings[index] || CONFIG.photoTimings[0];
    increaseWarpSpeed();
    if (t.flash)    { createFlashEffect(); createCameraShake(); }
    if (t.beatPunch)  createBeatPunch();
    const tl = gsap.timeline({onComplete:()=>animatePhoto(index+1)});
    slide.classList.add('active');
    gsap.set(slide,{opacity:0,zIndex:10+index,rotateY:t.rotateY*2,rotateX:10,scale:0.3,z:-2000});
    gsap.set(img,{scale:1,x:0,y:0,rotation:0});
    tl.to(slide,{opacity:1,rotateY:t.rotateY,rotateX:0,scale:1,z:t.translateZ,duration:CONFIG.fadeInDuration,ease:'power3.out'})
      .to(slide,{rotateY:t.rotateY*0.5,rotateX:t.rotate*0.3,z:t.translateZ*1.2,duration:t.duration*0.5,ease:'power1.inOut'},'<0.2')
      .to(img,{scale:t.zoom,x:t.moveX,y:t.moveY,rotation:t.rotate,duration:t.duration,ease:'power1.inOut'},'<')
      .to(slide,{opacity:0,rotateY:-t.rotateY*2,rotateX:-15,scale:1.5,z:2000,duration:CONFIG.fadeOutDuration,ease:'power2.in',
          onComplete:()=>slide.classList.remove('active')},`-=${CONFIG.fadeOutDuration}`);
}

function createFlashEffect() {
    gsap.timeline()
        .to(flashOverlay,{opacity:0.9,duration:CONFIG.flashDuration,ease:'power3.out'})
        .to(flashOverlay,{opacity:0,duration:CONFIG.flashDuration*1.5,ease:'power3.in'});
}
function createBeatPunch() {
    gsap.timeline()
        .to(cinematicContainer,{scale:CONFIG.beatPunchScale,duration:CONFIG.beatPunchDuration,ease:'power2.out'})
        .to(cinematicContainer,{scale:1,duration:CONFIG.beatPunchDuration*2,ease:'elastic.out(1,0.3)'});
}
function createCameraShake() {
    gsap.timeline()
        .to(cinematicContainer,{x:4,duration:0.05}).to(cinematicContainer,{x:-4,duration:0.05})
        .to(cinematicContainer,{x:3,duration:0.05}).to(cinematicContainer,{x:-3,duration:0.05})
        .to(cinematicContainer,{x:0,duration:0.05});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MOTIVATIONAL QUOTES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MOTIVATIONAL_QUOTES = [
    {text:'The only way to do great work is to love what you do.',author:'â€” Steve Jobs'},
    {text:'Believe you can and you\'re halfway there.',author:'â€” Theodore Roosevelt'},
    {text:'Success is not final, failure is not fatal: the courage to continue counts.',author:'â€” Winston Churchill'},
    {text:'The future belongs to those who believe in the beauty of their dreams.',author:'â€” Eleanor Roosevelt'},
    {text:'You are never too old to set another goal or to dream a new dream.',author:'â€” C.S. Lewis'},
    {text:'May Lord Shiva\'s divine energy guide you to achieve greatness.',author:'â€” Divine Blessing'}
];
let qIdx=0;

function showMotivationalQuote() {
    const qc=document.getElementById('motivationalQuote');
    const qt=document.getElementById('quoteText');
    const qa=document.getElementById('quoteAuthor');
    const q=MOTIVATIONAL_QUOTES[qIdx%MOTIVATIONAL_QUOTES.length];
    qt.textContent=''; qa.textContent='';
    gsap.to(qc,{opacity:1,duration:1,ease:'power2.out'});
    let i=0;
    const typeQ=()=>{if(i<q.text.length){qt.textContent=q.text.slice(0,++i);setTimeout(typeQ,45);}
        else setTimeout(()=>{gsap.to(qa,{opacity:1,duration:0.8});qa.textContent=q.author;},300);};
    typeQ();
    setTimeout(()=>{
        gsap.to(qc,{opacity:0,y:-20,duration:0.8,ease:'power2.in',onComplete:()=>{
            qIdx++;
            if(qIdx<MOTIVATIONAL_QUOTES.length*2) setTimeout(showMotivationalQuote,500);
        }});
    },5000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SHIVA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showShiva() {
    const sc=document.getElementById('shivaContainer');
    const si=document.getElementById('shivaImage');
    const sb=document.getElementById('shivaBlessing');
    const img=new Image();
    img.onload=()=>{si.src=img.src;go();};
    img.onerror=()=>go();
    img.src='natraja.jpg';
    function go() {
        gsap.set(sc,{opacity:0,scale:0.3,rotation:15,y:'100vh'});
        const tl=gsap.timeline({onComplete:()=>setTimeout(showMotivationalQuote,2000)});
        tl.to(sc,{opacity:1,duration:1,ease:'power2.out'})
          .to(sc,{scale:1,rotation:0,y:0,duration:3,ease:'power2.out'},'<')
          .to(sc,{y:-20,duration:2.5,ease:'sine.inOut',repeat:-1,yoyo:true},'+=0.5')
          .to(si,{rotation:2,duration:5,ease:'sine.inOut',repeat:-1,yoyo:true,transformOrigin:'center'},'<');
        setTimeout(()=>gsap.to(sb,{opacity:1,duration:1.5,ease:'back.out(1.2)'}),2000);
        setTimeout(createFlashEffect,3000);
        setTimeout(shivaParticles,2500);
    }
}

function shivaParticles() {
    const r=document.getElementById('shivaContainer').getBoundingClientRect();
    const cx=r.left+r.width/2, cy=r.top+r.height/2;
    // PERF: 20 particles only (was 50)
    for(let i=0;i<20;i++) setTimeout(()=>{
        const p=document.createElement('div');
        p.style.cssText=`position:fixed;width:6px;height:6px;border-radius:50%;
            background:${['#FFD700','#FFA500','#87CEEB','#FFFFFF'][i%4]};
            left:${cx}px;top:${cy}px;pointer-events:none;z-index:410;`;
        document.body.appendChild(p);
        const a=(Math.PI*2*i)/20, d=Math.random()*220+120;
        gsap.to(p,{x:Math.cos(a)*d,y:Math.sin(a)*d,opacity:0,scale:0,duration:1.8,ease:'power2.out',onComplete:()=>p.remove()});
    }, i*60);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FINAL MESSAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showFinalMessage() {
    gsap.to(finalMessage,{opacity:1,duration:2,ease:'power2.inOut'});
    finalMessage.classList.add('visible');

    const fullText='Happy Birthday Brother Mere Bhai Shivam Bhartiâœˆï¸';
    let ci=0;
    const typeChar=()=>{
        if(ci<fullText.length){birthdayText.textContent=fullText.slice(0,++ci);setTimeout(typeChar,100);}
        else setTimeout(()=>{document.querySelector('.birthday-text .cursor').style.display='none';showShlokas();},500);
    };
    setTimeout(typeChar,1000);
    gsap.fromTo(finalMessage,{scale:0.85},{scale:1,duration:3,ease:'power2.out'});
    // PERF: Pause THREE.js renderer â€” saves significant GPU
    setTimeout(()=>{ _3dPaused=true; },800);
    setTimeout(()=>{ confettiCanvas.classList.add('visible'); startConfetti(); },3000);
    setTimeout(startPostBirthdaySequence, 22000);
}

function showShlokas() {
    setTimeout(()=>{
        const s1=document.getElementById('shloka1'), t1=document.getElementById('shloka1Trans');
        typewriterEff(SHLOKAS[0].text,s1,150,()=>{gsap.to(t1,{opacity:1,duration:1});t1.textContent=SHLOKAS[0].translation;});
        gsap.to(shlokaContainer,{opacity:1,duration:1});
    },500);
    setTimeout(()=>{
        const s2=document.getElementById('shloka2'), t2=document.getElementById('shloka2Trans');
        typewriterEff(SHLOKAS[1].text,s2,120,()=>{gsap.to(t2,{opacity:1,duration:1});t2.textContent=SHLOKAS[1].translation;});
    },4000);
    setTimeout(()=>{
        let mi=0;
        const next=()=>{ if(mi<BIRTHDAY_MESSAGES.length){
            birthdayMessage.textContent=BIRTHDAY_MESSAGES[mi];
            gsap.to(birthdayMessage,{opacity:1,duration:1,onComplete:()=>
                setTimeout(()=>gsap.to(birthdayMessage,{opacity:0,duration:0.5,onComplete:()=>{mi++;next();}}),3000)});
        }};
        next();
    },8000);
}

function typewriterEff(text,el,speed,cb){
    let i=0; el.style.opacity='1';
    const t=()=>{if(i<text.length){el.textContent=text.slice(0,++i);setTimeout(t,speed);}else if(cb)cb();};
    t();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFETTI â€” optimised: clearRect instead of fillRect, auto-stop
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startConfetti() {
    const cv=confettiCanvas, ctx=cv.getContext('2d');
    cv.width=innerWidth; cv.height=innerHeight;
    const COLS=['#1E90FF','#4169E1','#87CEEB','#FFD700','#FFA500','#FFFFFF','#FF4500'];
    const P=Array.from({length:CONFETTI_N},()=>({
        x:Math.random()*cv.width, y:Math.random()*cv.height-cv.height,
        w:Math.random()*11+5, h:Math.random()*11+5,
        c:COLS[Math.random()*COLS.length|0],
        vy:Math.random()*4+2, vx:Math.random()*3-1.5,
        rot:Math.random()*360, rs:Math.random()*10-5, op:Math.random()*0.5+0.5
    }));
    let stop=false;
    // PERF: stop confetti after 22s automatically
    setTimeout(()=>{stop=true;},22000);
    const draw=()=>{
        if(stop){ctx.clearRect(0,0,cv.width,cv.height);return;}
        ctx.clearRect(0,0,cv.width,cv.height); // clearRect is faster than fillRect for sparse content
        P.forEach(p=>{
            p.y+=p.vy; p.x+=p.vx; p.rot+=p.rs; p.vy+=0.04;
            if(p.y>cv.height+10){p.y=-10;p.x=Math.random()*cv.width;p.vy=Math.random()*4+2;}
            ctx.save(); ctx.globalAlpha=p.op; ctx.translate(p.x,p.y);
            ctx.rotate(p.rot*Math.PI/180); ctx.fillStyle=p.c;
            ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore();
        });
        requestAnimationFrame(draw);
    };
    draw();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RESIZE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('resize',()=>{
    starsCanvas.width=innerWidth; starsCanvas.height=innerHeight;
    if(renderer && camera){camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);}
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded',()=>{
    createPhotoSlides();
    gsap.to(startButton,{scale:1.05,duration:1.2,repeat:-1,yoyo:true,ease:'sine.inOut'});
});


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  POST-BIRTHDAY GALAXY PHOTO SEQUENCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const GALLERY_PHOTOS = [
    {src:'images/photo1.jpeg',  caption:'ğŸŒŸ A Star Is Born'},
    {src:'images/photo2.jpeg',  caption:'âœˆï¸ Born to Fly'},
    {src:'images/photo3.jpeg',  caption:'ğŸ’« Chasing Dreams'},
    {src:'images/photo4.jpeg',  caption:'ğŸš€ Sky Is Not The Limit'},
    {src:'images/photo5.jpeg',  caption:'ğŸ¯ Always Focused'},
    {src:'images/photo6.jpeg',  caption:'ğŸ”¥ Pure Fire'},
    {src:'images/photo7.jpeg',  caption:'ğŸŒ™ Moonwalker'},
    {src:'images/photo8.jpeg',  caption:'ğŸ† Born Champion'},
    {src:'images/photo9.jpeg',  caption:'ğŸ‚ Blessed Soul'},
    {src:'images/photo10.jpeg', caption:'â¤ï¸ Mere Bhai'},
];

let postStars=[], postAnimId=null, postCanvas=null, postCtx=null;
// Pre-built background ImageData â€” drawn once, blitted every frame
let _bgCache=null;

function startPostBirthdaySequence() {
    const bl=document.getElementById('postBlackout');
    gsap.to(bl,{opacity:1,duration:2,ease:'power2.inOut',onComplete:()=>{
        gsap.to(backgroundMusic,{volume:0,duration:1.5,onComplete:()=>{try{backgroundMusic.pause();}catch(e){}}});
        const pm=document.getElementById('postMusic');
        pm.volume=0; pm.currentTime=0; pm.play().catch(()=>{});
        gsap.to(pm,{volume:0.75,duration:3,ease:'power2.out'});
        setTimeout(initPostGalaxy,900);
    }});
}

function initPostGalaxy() {
    postCanvas=document.getElementById('postGalaxyCanvas');
    postCtx=postCanvas.getContext('2d');

    // PERF FIX 7: render at 1Ã— DPR, CSS stretches it â€” massive fillRect saving
    postCanvas.width  = Math.round(innerWidth);
    postCanvas.height = Math.round(innerHeight);
    postCanvas.style.width  = innerWidth+'px';
    postCanvas.style.height = innerHeight+'px';

    const w=postCanvas.width, h=postCanvas.height;

    // Build static background once
    const offscreen=document.createElement('canvas');
    offscreen.width=w; offscreen.height=h;
    const oc=offscreen.getContext('2d');

    const bg=oc.createRadialGradient(w/2,h/2,0,w/2,h/2,w*0.9);
    bg.addColorStop(0,'rgba(12,0,45,1)'); bg.addColorStop(0.5,'rgba(5,0,22,1)'); bg.addColorStop(1,'rgba(0,0,5,1)');
    oc.fillStyle=bg; oc.fillRect(0,0,w,h);

    [{x:.2,y:.3,r:.28,c:'rgba(80,0,180,'},{x:.8,y:.7,r:.22,c:'rgba(0,60,180,'},{x:.5,y:.5,r:.18,c:'rgba(120,0,80,'}].forEach(n=>{
        const ng=oc.createRadialGradient(n.x*w,n.y*h,0,n.x*w,n.y*h,n.r*w);
        ng.addColorStop(0,n.c+'0.09)'); ng.addColorStop(1,n.c+'0)');
        oc.fillStyle=ng; oc.fillRect(0,0,w,h);
    });
    const mw=oc.createLinearGradient(0,h*.35,w,h*.65);
    mw.addColorStop(0,'rgba(100,80,180,0)'); mw.addColorStop(.5,'rgba(130,100,240,0.09)'); mw.addColorStop(1,'rgba(100,80,180,0)');
    oc.fillStyle=mw; oc.fillRect(0,0,w,h);

    _bgCache=offscreen;

    // Sparse star set
    const SCOLS=['rgba(255,255,255,','rgba(135,206,235,','rgba(255,215,0,','rgba(180,130,255,'];
    postStars=Array.from({length:POST_STARS},()=>({
        x:Math.random()*w, y:Math.random()*h,
        r:Math.random()*2+0.3,
        op:Math.random()*0.65+0.2,
        ts:Math.random()*0.025+0.006,
        tp:Math.random()*Math.PI*2,
        c:SCOLS[Math.random()*SCOLS.length|0]
    }));

    gsap.to(postCanvas,{opacity:1,duration:2.5,ease:'power2.out'});
    gsap.to(document.getElementById('postBlackout'),{opacity:0,duration:2.5,ease:'power2.out',onComplete:()=>{
        document.getElementById('postBlackout').style.pointerEvents='none';
    }});

    animatePostGalaxy(0);
    setTimeout(()=>{buildDots();showGalleryPhoto(0);},2600);
}

// PERF FIX 8: throttle galaxy to 30fps, blit cached background
let _lastGF=0;
function animatePostGalaxy(ts) {
    postAnimId=requestAnimationFrame(animatePostGalaxy);
    if(ts-_lastGF < 34) return; // ~30fps
    _lastGF=ts;

    const w=postCanvas.width, h=postCanvas.height;
    // Blit the static background
    postCtx.drawImage(_bgCache,0,0,w,h);

    // Draw twinkling stars on top
    const now=Date.now()*.001;
    postStars.forEach(s=>{
        const twk=0.5+0.5*Math.sin(now*s.ts*60+s.tp);
        const a=s.op*(0.4+0.6*twk);
        postCtx.beginPath();
        postCtx.arc(s.x,s.y,s.r,0,Math.PI*2);
        postCtx.fillStyle=s.c+a+')';
        postCtx.fill();
        if(s.r>1.6 && a>0.65){
            postCtx.strokeStyle=s.c+(a*0.35)+')';
            postCtx.lineWidth=0.5;
            postCtx.beginPath();
            postCtx.moveTo(s.x-s.r*3,s.y); postCtx.lineTo(s.x+s.r*3,s.y);
            postCtx.moveTo(s.x,s.y-s.r*3); postCtx.lineTo(s.x,s.y+s.r*3);
            postCtx.stroke();
        }
    });
}

function buildDots() {
    const el=document.getElementById('photoDots');
    el.innerHTML='';
    GALLERY_PHOTOS.forEach((_,i)=>{const d=document.createElement('div');d.className='photo-dot';d.id=`dot-${i}`;el.appendChild(d);});
    gsap.to(el,{opacity:1,duration:1});
}
function setDot(i){document.querySelectorAll('.photo-dot').forEach((d,j)=>d.classList.toggle('active',j===i));}

function showGalleryPhoto(index) {
    if(index>=GALLERY_PHOTOS.length){setTimeout(showEndCard,1200);return;}
    const photo=GALLERY_PHOTOS[index];
    const gallery=document.getElementById('photoGallery');
    gsap.to(gallery,{opacity:1,duration:0.5});

    const counter=document.getElementById('photoCounter');
    counter.textContent=`${index+1} / ${GALLERY_PHOTOS.length}`;
    gsap.to(counter,{opacity:1,duration:0.5});

    const caption=document.getElementById('photoCaption');
    caption.textContent=photo.caption;
    setDot(index);

    const photoEl=document.createElement('div');
    photoEl.className='gallery-photo';
    const pw=isMobile?Math.min(innerWidth*.92,420):Math.min(innerWidth*.72,900);
    const ph=isMobile?Math.min(innerHeight*.65,520):Math.min(innerHeight*.78,680);
    photoEl.style.width=pw+'px'; photoEl.style.height=ph+'px';

    const img=document.createElement('img');
    img.alt=photo.caption;
    img.onerror=()=>{img.onerror=null; img.src=makePlaceholder(index,photo.caption);};
    img.src=photo.src;
    photoEl.appendChild(img); gallery.appendChild(photoEl);

    // Entrance styles â€” 10 unique animations
    const enters=[
        ()=>{gsap.set(photoEl,{y:'110vh',opacity:0,scale:.85});gsap.to(photoEl,{y:0,opacity:1,scale:1,duration:1.1,ease:'power3.out'});},
        ()=>{gsap.set(photoEl,{x:'-110vw',opacity:0});gsap.to(photoEl,{x:0,opacity:1,duration:1.0,ease:'power3.out'});},
        ()=>{gsap.set(photoEl,{x:'110vw',opacity:0});gsap.to(photoEl,{x:0,opacity:1,duration:1.0,ease:'power3.out'});},
        ()=>{gsap.set(photoEl,{scale:.05,opacity:0});gsap.to(photoEl,{scale:1,opacity:1,duration:1.2,ease:'power2.out'});},
        ()=>{gsap.set(photoEl,{scale:.1,opacity:0,rotation:180});gsap.to(photoEl,{scale:1,opacity:1,rotation:0,duration:1.1,ease:'back.out(1.3)'});},
        ()=>{gsap.set(photoEl,{rotationY:85,opacity:0});gsap.to(photoEl,{rotationY:0,opacity:1,duration:1.0,ease:'power2.out'});},
        ()=>{gsap.set(photoEl,{y:'-110vh',opacity:0,scale:.9});gsap.to(photoEl,{y:0,opacity:1,scale:1,duration:1.1,ease:'bounce.out'});},
        ()=>{gsap.set(photoEl,{x:'-70vw',y:'-70vh',opacity:0,scale:.7});gsap.to(photoEl,{x:0,y:0,opacity:1,scale:1,duration:1.0,ease:'power3.out'});},
        ()=>{gsap.set(photoEl,{scale:0,opacity:0});gsap.to(photoEl,{scale:1,opacity:1,duration:1.1,ease:'elastic.out(1,.6)'});},
        ()=>{gsap.set(photoEl,{scaleX:.02,opacity:0});gsap.to(photoEl,{scaleX:1,opacity:1,duration:.8,ease:'power3.out'});},
    ];
    enters[index%enters.length]();

    gsap.to(caption,{opacity:1,duration:.8,delay:.5,ease:'power2.out'});

    // Ken-Burns â€” subtle
    gsap.to(img,{scale:1.04,x:(Math.random()-.5)*10,y:(Math.random()-.5)*8,duration:5,ease:'sine.inOut'});

    setTimeout(()=>{
        gsap.to(photoEl,{opacity:0,scale:.88,y:'-18px',duration:.65,ease:'power2.in',onComplete:()=>{
            photoEl.remove();
            gsap.to(caption,{opacity:0,duration:.25});
            showGalleryPhoto(index+1);
        }});
    },5000);
}

function makePlaceholder(idx,cap) {
    const c=document.createElement('canvas'); c.width=800; c.height=600;
    const ctx=c.getContext('2d');
    const pals=[['#0D1B2A','#1E90FF','#87CEEB'],['#1a0533','#8B00FF','#DA70D6'],['#001a00','#006400','#00FF7F'],
                 ['#1a0a00','#8B4500','#FFD700'],['#000d1a','#006080','#00FFCC'],['#1a001a','#800080','#FF69B4'],
                 ['#0a0020','#4B0082','#9370DB'],['#001a1a','#005050','#00CED1'],['#1a0000','#8B0000','#FF6347'],
                 ['#0a0a00','#555500','#FFD700']];
    const pal=pals[idx%pals.length];
    const g=ctx.createRadialGradient(400,300,0,400,300,450);
    g.addColorStop(0,pal[1]); g.addColorStop(.6,pal[0]); g.addColorStop(1,'#000');
    ctx.fillStyle=g; ctx.fillRect(0,0,800,600);
    for(let i=0;i<50;i++){ctx.beginPath();ctx.arc(Math.random()*800,Math.random()*600,Math.random()*1.5+.2,0,Math.PI*2);ctx.fillStyle=`rgba(255,255,255,${Math.random()*.7+.2})`;ctx.fill();}
    ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.font='bold 48px Rajdhani,sans-serif'; ctx.fillStyle='#FFF'; ctx.shadowColor=pal[1]; ctx.shadowBlur=20;
    ctx.fillText(cap,400,285);
    ctx.font='28px Rajdhani,sans-serif'; ctx.fillStyle=pal[2]; ctx.shadowBlur=10;
    ctx.fillText('Shivam Bharti',400,350);
    ctx.strokeStyle='#FFD700'; ctx.lineWidth=4; ctx.shadowColor='#FFD700'; ctx.shadowBlur=18;
    ctx.strokeRect(10,10,780,580);
    return c.toDataURL('image/jpeg',.8);
}

function showEndCard() {
    gsap.to(['#photoGallery','#photoCaption','#photoCounter','#photoDots'],{opacity:0,duration:.8});
    const ec=document.getElementById('endCard');
    gsap.to(ec,{opacity:1,duration:2,ease:'power2.inOut',pointerEvents:'auto'});
    gsap.from('.end-title',{y:60,opacity:0,duration:1.5,ease:'back.out(1.7)',delay:.5});
    gsap.from('.end-subtitle',{y:40,opacity:0,duration:1.2,ease:'power2.out',delay:1.2});
    gsap.from('.end-translation',{y:30,opacity:0,duration:1.0,ease:'power2.out',delay:1.8});
    // Stop galaxy loop
    if(postAnimId){cancelAnimationFrame(postAnimId);postAnimId=null;}
    // 30 burst particles only
    for(let i=0;i<30;i++) setTimeout(()=>{
        const p=document.createElement('div');
        const sz=Math.random()*7+3;
        p.style.cssText=`position:fixed;border-radius:50%;pointer-events:none;z-index:2040;
            width:${sz}px;height:${sz}px;
            background:${['#FFD700','#FFA500','#87CEEB','#FFFFFF','#FF69B4'][i%5]};
            left:${35+Math.random()*30}vw;top:50vh;`;
        document.body.appendChild(p);
        gsap.to(p,{x:(Math.random()-.5)*innerWidth*.7,y:(Math.random()-1.3)*innerHeight*.7,
            opacity:0,scale:0,duration:2+Math.random()*1.5,ease:'power2.out',onComplete:()=>p.remove()});
    },i*55);
}
</script>
</body>
</html>